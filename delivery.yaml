build_steps:
  - desc: Build
    env:
     GITHUB_TOKEN:
       secret_id: "gh_test"
       secret_version: "51d07aad-0b9f-423d-b987-b53868308721"
       available_in_pull_requests: true
    cmd: |
      wget https://github.com/github/codeql-action/releases/latest/download/codeql-runner-linux
      chmod +x codeql-runner-linux
      ./codeql-runner-linux init --repository "zalando/zappr" --github-url https://github.com --github-auth "$GITHUB_TOKEN"
      COMMIT=`git rev-parse HEAD`
      echo "$COMMIT"
      ./codeql-runner-linux analyze --repository "zalando/zappr" --github-url https://github.com --github-auth "$GITHUB_TOKEN" --commit "$COMMIT" --ref "refs/heads/main"

      #function npm {
      #  docker run -i --rm -v "$(pwd):/workspace" -w /workspace registry.opensource.zalan.do/stups/node:latest npm "$@"
      #}
      #
      #npm install --no-optional
      #npm run dist
